# í”„ë¡œì íŠ¸ êµ¬ì¡° ë° ì£¼ìš” ì‚¬í•­

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
user_tracking_automation/
â”œâ”€â”€ config/                          # ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ SRP/                         # ì˜ì—­ë³„ ì„¤ì • í´ë”
â”‚   â”‚   â”œâ”€â”€ ë¨¼ì € ë‘˜ëŸ¬ë³´ì„¸ìš”.json     # ëª¨ë“ˆë³„ ì„¤ì • íŒŒì¼
â”‚   â”‚   â””â”€â”€ ì¼ë°˜ìƒí’ˆ.json
â”‚   â”œâ”€â”€ PDP/                         # (í–¥í›„ ì¶”ê°€)
â”‚   â”œâ”€â”€ HOME/                        # (í–¥í›„ ì¶”ê°€)
â”‚   â”œâ”€â”€ CART/                        # (í–¥í›„ ì¶”ê°€)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ validation_rules.py
â”œâ”€â”€ features/                        # BDD Feature íŒŒì¼
â”‚   â””â”€â”€ srp_tracking.feature        # SRP ì˜ì—­ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
â”œâ”€â”€ steps/                           # BDD Step Definitions
â”‚   â”œâ”€â”€ home_steps.py               # í™ˆí˜ì´ì§€ ê´€ë ¨ ìŠ¤í… (ì˜ì—­ ì¶”ë¡  í¬í•¨)
â”‚   â”œâ”€â”€ srp_lp_steps.py             # SRP/LP ê´€ë ¨ ìŠ¤í…
â”‚   â”œâ”€â”€ tracking_validation_steps.py # íŠ¸ë˜í‚¹ ë¡œê·¸ ê²€ì¦ ìŠ¤í…
â”‚   â””â”€â”€ ...
â”œâ”€â”€ pages/                           # Page Object Model
â”‚   â”œâ”€â”€ home_page.py
â”‚   â”œâ”€â”€ search_page.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ utils/                           # ìœ í‹¸ë¦¬í‹° ëª¨ë“ˆ
â”‚   â”œâ”€â”€ NetworkTracker.py           # ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í‚¹ ë¡œê·¸ ìˆ˜ì§‘
â”‚   â”œâ”€â”€ validation_helpers.py       # ì •í•©ì„± ê²€ì¦ í—¬í¼ í•¨ìˆ˜
â”‚   â””â”€â”€ ...
â”œâ”€â”€ json/                            # ìˆ˜ì§‘ëœ ë¡œê·¸ ì €ì¥ ë””ë ‰í† ë¦¬
â”œâ”€â”€ docs/                            # ë¬¸ì„œ
â”‚   â”œâ”€â”€ project_structure.md        # ì´ ë¬¸ì„œ
â”‚   â””â”€â”€ flow_sequence_diagram.md
â”œâ”€â”€ conftest.py                      # Pytest ì„¤ì • ë° Fixture
â”œâ”€â”€ pytest.ini                       # Pytest ì„¤ì •
â””â”€â”€ test_srp.py                      # í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íŒŒì¼
```

## ğŸ—ï¸ ëª¨ë“ˆ ì„¤ì • íŒŒì¼ êµ¬ì¡°

### ì˜ì—­ë³„ í´ë” êµ¬ì¡°

ê¸°ì¡´ì˜ ë‹¨ì¼ `module_config.json` íŒŒì¼ì„ ì˜ì—­ë³„ í´ë” êµ¬ì¡°ë¡œ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤:

```
config/
â”œâ”€â”€ SRP/                             # Search Results Page
â”‚   â”œâ”€â”€ ë¨¼ì € ë‘˜ëŸ¬ë³´ì„¸ìš”.json
â”‚   â””â”€â”€ ì¼ë°˜ìƒí’ˆ.json
â”œâ”€â”€ PDP/                             # Product Detail Page (í–¥í›„)
â”œâ”€â”€ HOME/                            # Home Page (í–¥í›„)
â””â”€â”€ CART/                            # Shopping Cart (í–¥í›„)
```

### ëª¨ë“ˆ ì„¤ì • íŒŒì¼ í˜•ì‹

ê° ëª¨ë“ˆ ì„¤ì • íŒŒì¼ì€ **common ì„¹ì…˜ ì—†ì´** ê° ì´ë²¤íŠ¸ë³„ ì„¹ì…˜ì— í•„ìš”í•œ ê°’ë“¤ì„ ì§ì ‘ í¬í•¨í•©ë‹ˆë‹¤:

```json
{
  "module_exposure": {
    "channel_code": "200003514",
    "cguid": "11412244806446005562000000",
    "spm-url": "gmktpc.home.searchtop",
    "spm-pre": "",
    "spm-cnt": "gmktpc.searchlist",
    "spm": "gmktpc.searchlist.cpc",
    "params-exp": {
      "parsed": {
        "module_index": "3",
        "ab_buckets": "mandatory"
      }
    }
  },
  "product_exposure": {
    "channel_code": "200003514",
    "cguid": "11412244806446005562000000",
    "spm-url": "gmktpc.home.searchtop",
    "spm-pre": "",
    "spm-cnt": "gmktpc.searchlist",
    "spm": "gmktpc.searchlist.cpc",
    "params-exp": {
      "parsed": {
        ...
      }
    }
  },
  "product_click": {
    ...
  },
  "pdp_pv": {
    ...
  }
}
```

**ì£¼ìš” íŠ¹ì§•:**
- âŒ `common` ì„¹ì…˜ ì œê±°
- âœ… ê° ì´ë²¤íŠ¸ë³„ ì„¹ì…˜(`module_exposure`, `product_exposure` ë“±)ì— í•„ìš”í•œ ê°’ ì§ì ‘ í¬í•¨
- âœ… ë™ì¼í•œ ê°’ì´ë¼ë„ ê° ì´ë²¤íŠ¸ ì„¹ì…˜ì— ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±

### ì˜ì—­ ìë™ ì¶”ë¡ 

Feature íŒŒì¼ëª…ì—ì„œ ì˜ì—­ì„ ìë™ìœ¼ë¡œ ì¶”ë¡ í•©ë‹ˆë‹¤:

- `srp_tracking.feature` â†’ `SRP` ì˜ì—­
- `pdp_tracking.feature` â†’ `PDP` ì˜ì—­
- `home_tracking.feature` â†’ `HOME` ì˜ì—­
- `cart_tracking.feature` â†’ `CART` ì˜ì—­

ì˜ì—­ ì¶”ë¡ ì€ `steps/home_steps.py`ì˜ `@given("Gë§ˆì¼“ í™ˆ í˜ì´ì§€ì— ì ‘ì†í–ˆìŒ")` ìŠ¤í…ì—ì„œ ìˆ˜í–‰ë˜ë©°, `bdd_context.store['area']`ì— ì €ì¥ë©ë‹ˆë‹¤.

## ğŸ” ê²€ì¦ ë¡œì§

### íŠ¹ìˆ˜ ê°’ ì²˜ë¦¬

#### 1. `"mandatory"` - í•„ìˆ˜ í•„ë“œ

```json
{
  "ab_buckets": "mandatory"
}
```

- **ì˜ë¯¸**: í•´ë‹¹ í•„ë“œëŠ” ë°˜ë“œì‹œ ê°’ì´ ìˆì–´ì•¼ í•¨
- **ë™ì‘**: ì‹¤ì œ ë¡œê·¸ì— ê°’ì´ ì—†ê±°ë‚˜ ë¹ˆ ë¬¸ìì—´ì´ë©´ ê²€ì¦ ì‹¤íŒ¨
- **ë‚´ë¶€ ë³€í™˜**: `"mandatory"` â†’ `"__MANDATORY__"`

#### 2. `"skip"` - ê²€ì¦ ìŠ¤í‚µ

```json
{
  "spm-pre": "skip"
}
```

- **ì˜ë¯¸**: í•´ë‹¹ í•„ë“œëŠ” ê²€ì¦ì„ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ
- **ë™ì‘**: ì‹¤ì œ ë¡œê·¸ì— ì–´ë–¤ ê°’ì´ ìˆë“  ìƒê´€ì—†ì´ ê²€ì¦ í†µê³¼
- **ë‚´ë¶€ ë³€í™˜**: `"skip"` â†’ `"__SKIP__"`

#### 3. ë¹ˆ ë¬¸ìì—´ `""` - ì •í™•íˆ ë¹ˆ ê°’ì´ì–´ì•¼ í•¨

```json
{
  "spm-pre": ""
}
```

- **ì˜ë¯¸**: í•´ë‹¹ í•„ë“œëŠ” ë°˜ë“œì‹œ ë¹ˆ ë¬¸ìì—´ì´ì–´ì•¼ í•¨
- **ë™ì‘**: ì‹¤ì œ ë¡œê·¸ì— ê°’ì´ ìˆìœ¼ë©´ ê²€ì¦ ì‹¤íŒ¨
- **ì˜ˆì‹œ**: 
  - Expected: `""`, Actual: `""` â†’ âœ… í†µê³¼
  - Expected: `""`, Actual: `"something"` â†’ âŒ ì‹¤íŒ¨

#### 4. ë¦¬ìŠ¤íŠ¸ ê°’ - í—ˆìš© ê°€ëŠ¥í•œ ê°’ ëª©ë¡

```json
{
  "ab_buckets": ["#108^4#B", "#108^3#B"],
  "is_ad": ["Y", "N"]
}
```

- **ì˜ë¯¸**: í•´ë‹¹ í•„ë“œëŠ” ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ëœ ê°’ ì¤‘ í•˜ë‚˜ì™€ ì¼ì¹˜í•˜ë©´ í†µê³¼
- **ë™ì‘**: ì‹¤ì œ ë¡œê·¸ ê°’ì´ ë¦¬ìŠ¤íŠ¸ ë‚´ ì–´ëŠ ê°’ê³¼ë“  ì¼ì¹˜í•˜ë©´ ê²€ì¦ í†µê³¼ (ë¶€ë¶„ ë§¤ì¹­, OR ì¡°ê±´)
- **ì˜ˆì‹œ**:
  - Expected: `["#108^4#B", "#108^3#B"]`, Actual: `"#108^4#B"` â†’ âœ… í†µê³¼
  - Expected: `["#108^4#B", "#108^3#B"]`, Actual: `"#108^3#B"` â†’ âœ… í†µê³¼
  - Expected: `["#108^4#B", "#108^3#B"]`, Actual: `"#108^5#B"` â†’ âŒ ì‹¤íŒ¨
  - Expected: `["Y", "N"]`, Actual: `"Y"` â†’ âœ… í†µê³¼
  - Expected: `["Y", "N"]`, Actual: `"N"` â†’ âœ… í†µê³¼

#### 5. í”Œë ˆì´ìŠ¤í™€ë” - ë™ì  ê°’ ëŒ€ì²´

```json
{
  "_p_prod": "<ìƒí’ˆë²ˆí˜¸>",
  "query": "<ê²€ìƒ‰ì–´>",
  "origin_price": "<ì›ê°€>",
  "promotion_price": "<í• ì¸ê°€>",
  "coupon_price": "<ì¿ í°ì ìš©ê°€>",
  "server_env": "<environment>"
}
```

- **ì˜ë¯¸**: ì‹¤ì œ ê°’ìœ¼ë¡œ ìë™ ëŒ€ì²´ë¨
- **ëŒ€ì²´ ì†ŒìŠ¤**:
  - `<ìƒí’ˆë²ˆí˜¸>`: `goodscode` íŒŒë¼ë¯¸í„°
  - `<ê²€ìƒ‰ì–´>`: `bdd_context`ì˜ `keyword`
  - `<ì›ê°€>`, `<í• ì¸ê°€>`, `<ì¿ í°ì ìš©ê°€>`: PDP PV ë¡œê·¸ì—ì„œ ì¶”ì¶œí•œ ê°€ê²© ì •ë³´
  - `<environment>`: `config.json`ì˜ `environment` ê°’ (ì˜ˆ: `"prod"`, `"dev"`, `"stg"`)

### ê²€ì¦ í”„ë¡œì„¸ìŠ¤

1. **ëª¨ë“ˆ ì„¤ì • íŒŒì¼ ë¡œë“œ**
   - Feature íŒŒì¼ëª…ì—ì„œ ì˜ì—­ ì¶”ë¡ 
   - `config/{area}/{module_title}.json` íŒŒì¼ ë¡œë“œ

2. **ì˜ˆìƒ ê°’ ìƒì„±**
   - í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ëŒ€ì²´
   - `"mandatory"` â†’ `"__MANDATORY__"` ë³€í™˜
   - `"skip"` â†’ `"__SKIP__"` ë³€í™˜

3. **ì‹¤ì œ ë¡œê·¸ ê²€ì¦**
   - íŠ¸ë˜í‚¹ ë¡œê·¸ì—ì„œ í•„ë“œê°’ ì¶”ì¶œ
   - ì˜ˆìƒ ê°’ê³¼ ì‹¤ì œ ê°’ ë¹„êµ
   - `__SKIP__` ë§ˆì»¤ëŠ” ê²€ì¦ ìŠ¤í‚µ
   - ë¦¬ìŠ¤íŠ¸ í˜•íƒœì˜ ì˜ˆìƒ ê°’ì€ ì‹¤ì œ ê°’ì´ ë¦¬ìŠ¤íŠ¸ ë‚´ ì–´ëŠ ê°’ê³¼ë“  ì¼ì¹˜í•˜ë©´ í†µê³¼

## ğŸ“ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. `utils/validation_helpers.py`

#### `load_module_config(area, module_title, feature_path)`
- ì˜ì—­ê³¼ ëª¨ë“ˆëª…ì„ ê¸°ë°˜ìœ¼ë¡œ ì„¤ì • íŒŒì¼ ë¡œë“œ
- Feature íŒŒì¼ëª…ì—ì„œ ì˜ì—­ ìë™ ì¶”ë¡  ì§€ì›

#### `detect_area_from_feature_path(feature_path)`
- Feature íŒŒì¼ ê²½ë¡œì—ì„œ ì˜ì—­ ì¶”ë¡ 
- `{area}_tracking.feature` íŒ¨í„´ ì¸ì‹

#### `build_expected_from_module_config(module_config, event_type, ...)`
- ëª¨ë“ˆ ì„¤ì •ì—ì„œ ì˜ˆìƒ ê°’ ìƒì„±
- common ì„¹ì…˜ ì—†ì´ ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì„¹ì…˜ë§Œ ì²˜ë¦¬

#### `validate_event_type_logs(tracker, event_type, ...)`
- íŠ¹ì • ì´ë²¤íŠ¸ íƒ€ì…ì˜ ë¡œê·¸ ê²€ì¦ ìˆ˜í–‰
- ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì„¹ì…˜ì—ì„œ spm ê°’ ì¶”ì¶œ

### 2. `utils/NetworkTracker.py`

#### `validate_payload(log, expected_data, ...)`
- ì‹¤ì œ ë¡œê·¸ì™€ ì˜ˆìƒ ê°’ ë¹„êµ
- `__SKIP__`, `__MANDATORY__` íŠ¹ìˆ˜ ë§ˆì»¤ ì²˜ë¦¬
- í¬í•¨ ì—¬ë¶€ ë§¤ì¹­ (spm, spm-url, spm-pre, spm-cnt í•„ë“œ)

### 3. `steps/home_steps.py`

#### `@given("Gë§ˆì¼“ í™ˆ í˜ì´ì§€ì— ì ‘ì†í–ˆìŒ")`
- í™ˆ í˜ì´ì§€ ì ‘ì† ë° ì˜ì—­ ì¶”ë¡  ìˆ˜í–‰
- Feature íŒŒì¼ ê²½ë¡œì—ì„œ ì˜ì—­ ì¶”ë¡ í•˜ì—¬ `bdd_context.store['area']`ì— ì €ì¥

### 4. `steps/tracking_validation_steps.py`

#### `_get_common_context(bdd_context)`
- ê³µí†µ context ê°’ í™•ì¸ ë° ë°˜í™˜
- `area` ê°’ ê²€ì¦ (ì—†ìœ¼ë©´ ì˜¤ë¥˜ ë°œìƒ)

#### ê²€ì¦ ìŠ¤í…ë“¤
- `@then("Module Exposure ë¡œê·¸ê°€ ì •í•©ì„± ê²€ì¦ì„ í†µê³¼í•´ì•¼ í•¨")`
- `@then("Product Exposure ë¡œê·¸ê°€ ì •í•©ì„± ê²€ì¦ì„ í†µê³¼í•´ì•¼ í•¨")`
- `@then("Product Click ë¡œê·¸ê°€ ì •í•©ì„± ê²€ì¦ì„ í†µê³¼í•´ì•¼ í•¨")`
- ë“±ë“±...

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ì˜ì—­ ì¶”ë¡  ì‹¤íŒ¨

- Feature íŒŒì¼ëª…ì´ `{area}_tracking.feature` í˜•ì‹ì´ ì•„ë‹ˆë©´ ì˜ì—­ ì¶”ë¡  ì‹¤íŒ¨
- `bdd_context.store['area']`ê°€ ì—†ìœ¼ë©´ ê²€ì¦ ì‹œ `ValueError` ë°œìƒ
- `steps/home_steps.py`ì˜ ê¸°ë³¸ê°’ ì‚¬ìš© ë¶€ë¶„ í™•ì¸ í•„ìš”

### 2. ëª¨ë“ˆ ì„¤ì • íŒŒì¼ ê²½ë¡œ

- íŒŒì¼ëª…ì€ ì •í™•íˆ ëª¨ë“ˆ íƒ€ì´í‹€ê³¼ ì¼ì¹˜í•´ì•¼ í•¨
- ì˜ˆ: ëª¨ë“ˆ íƒ€ì´í‹€ì´ `"ë¨¼ì € ë‘˜ëŸ¬ë³´ì„¸ìš”"`ë©´ íŒŒì¼ëª…ë„ `ë¨¼ì € ë‘˜ëŸ¬ë³´ì„¸ìš”.json`ì´ì–´ì•¼ í•¨
- íŒŒì¼ ê²½ë¡œ: `config/{area}/{module_title}.json`

### 3. ë¹ˆ ë¬¸ìì—´ vs skip

- ë¹ˆ ë¬¸ìì—´ `""`: ì •í™•íˆ ë¹ˆ ê°’ì´ì–´ì•¼ í•¨ (ê°’ì´ ìˆìœ¼ë©´ ì‹¤íŒ¨)
- `"skip"`: ì–´ë–¤ ê°’ì´ë“  ìƒê´€ì—†ìŒ (ê²€ì¦ ìŠ¤í‚µ)

### 4. í•„ë“œ ê²€ì¦ ìˆœì„œ

1. `actual_value is None` â†’ ê°’ì´ ì—†ìœ¼ë©´ ì—ëŸ¬
2. `expected_value == "__SKIP__"` â†’ ê²€ì¦ ìŠ¤í‚µ
3. `expected_value == "__MANDATORY__"` â†’ ê°’ì´ ìˆìœ¼ë©´ í†µê³¼, ì—†ìœ¼ë©´ ì—ëŸ¬
4. `isinstance(expected_value, list)` â†’ **í—ˆìš© ê°’ ëª©ë¡ ê²€ì¦**: ì‹¤ì œ ê°’ì´ ë¦¬ìŠ¤íŠ¸ ë‚´ ì–´ëŠ ê°’ê³¼ë“  ì¼ì¹˜í•˜ë©´ í†µê³¼ (OR ì¡°ê±´)
5. í¬í•¨ ì—¬ë¶€ ë§¤ì¹­ (spm ê´€ë ¨ í•„ë“œ)
6. ì •í™• ì¼ì¹˜ ë¹„êµ

## ğŸ”„ ë°ì´í„° íë¦„

1. **Feature íŒŒì¼ ì‹¤í–‰**
   ```
   features/srp_tracking.feature
   â†“
   steps/home_steps.py: @given("Gë§ˆì¼“ í™ˆ í˜ì´ì§€ì— ì ‘ì†í–ˆìŒ")
   â†“
   ì˜ì—­ ì¶”ë¡ : "srp_tracking" â†’ "SRP"
   â†“
   bdd_context.store['area'] = "SRP"
   ```

2. **ëª¨ë“ˆ ì„¤ì • ë¡œë“œ**
   ```
   steps/tracking_validation_steps.py: load_module_config()
   â†“
   area="SRP", module_title="ë¨¼ì € ë‘˜ëŸ¬ë³´ì„¸ìš”"
   â†“
   config/SRP/ë¨¼ì € ë‘˜ëŸ¬ë³´ì„¸ìš”.json ë¡œë“œ
   ```

3. **ê²€ì¦ ìˆ˜í–‰**
   ```
   NetworkTracker.validate_payload()
   â†“
   ì‹¤ì œ ë¡œê·¸ vs ì˜ˆìƒ ê°’ ë¹„êµ
   â†“
   __SKIP__: ê²€ì¦ ìŠ¤í‚µ
   __MANDATORY__: ê°’ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
   ì¼ë°˜ ê°’: ì •í™• ì¼ì¹˜ ë˜ëŠ” í¬í•¨ ì—¬ë¶€ ë§¤ì¹­
   ```

## ğŸ“Œ ìƒˆ ëª¨ë“ˆ ì¶”ê°€ ë°©ë²•

### 1. ì„¤ì • íŒŒì¼ ìƒì„±

```
config/SRP/ìƒˆëª¨ë“ˆëª….json
```

### 2. ì„¤ì • íŒŒì¼ ì‘ì„±

```json
{
  "module_exposure": {
    "channel_code": "...",
    "spm": "...",
    ...
  },
  "product_exposure": {
    ...
  },
  ...
}
```

### 3. Feature íŒŒì¼ì—ì„œ ì‚¬ìš©

```gherkin
Given ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ì— "ìƒˆëª¨ë“ˆëª…" ëª¨ë“ˆì´ ìˆë‹¤
When ì‚¬ìš©ìê°€ "ìƒˆëª¨ë“ˆëª…" ëª¨ë“ˆ ë‚´ ìƒí’ˆì„ í™•ì¸í•˜ê³  í´ë¦­í•œë‹¤
Then Module Exposure ë¡œê·¸ê°€ ì •í•©ì„± ê²€ì¦ì„ í†µê³¼í•´ì•¼ í•¨ (TC: C12345)
```

## ğŸš€ í–¥í›„ ê°œì„  ì‚¬í•­

1. **ë‹¤ë¥¸ ì˜ì—­ ì§€ì›**: PDP, HOME, CART ë“±
2. **ì„¤ì • íŒŒì¼ ê²€ì¦**: JSON ìŠ¤í‚¤ë§ˆ ê²€ì¦
3. **ìë™ ì˜ì—­ ê°ì§€ ê°œì„ **: ë” ì •í™•í•œ ì¶”ë¡  ë¡œì§
4. **ì„¤ì • íŒŒì¼ ìë™ ìƒì„±**: í…œí”Œë¦¿ ê¸°ë°˜
